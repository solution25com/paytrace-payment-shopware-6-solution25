{% extends '@Storefront/storefront/page/account/index.html.twig' %}

{% block page_account_main_content %}
    <div class="payTrace-saved b2b-create-title-text">
        <input type="hidden" name="parentname" value="payTrace Saved Cards">
    </div>

    <div id="payTracePluginWrapper"
         payTrace-saved-cards-plugin
         data-client-key="{{ paymentToken }}"
         data-mode = "{{ mode }}"
        >

        <div class="sc-form-toggle-wrapper text-center my-4">
            <button class="sc-form-toggle-btn" type="button" id="toggleAddCardForm">
        <span class="sc-form-toggle-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
                <span class="sc-form-toggle-text">{{ "paytrace_shopware6.savedCards.add_new_card"|trans }}</span>
            </button>
        </div>

        <div class="container sc-form-container" id="addCardFormContainer" style="display: none;">
            <div class="card shadow-sm mb-4 sc-form-card">
                <div class="card-body sc-form-card-body">
                    <h5 class="card-title text-center mb-4 sc-form-title">{{ "paytrace_shopware6.savedCards.add_new_card_title"|trans }}</h5>
                    <form class="paytrace-form-container sc-form">
                        <div class="row sc-form-row">
                            <div class="col-md-12 mb-2 sc-form-col">
                                <label for="nameSurname" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.name_on_card"|trans }}</label>
                                <input type="text" class="form-control sc-form-input" id="nameSurname" name="nameSurname"
                                       placeholder="John Smith" required/>
                            </div>
                        </div>

                        <div class="row sc-form-row">
                            <div class="col-md-6 mb-2 sc-form-col">
                                <label for="streetAddress" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.street_address"|trans }}</label>
                                <input type="text" class="form-control form-control-sm sc-form-input" id="streetAddress"
                                       name="streetAddress" placeholder="123 Main St" required/>
                            </div>

                            <div class="col-md-6 mb-2 sc-form-col">
                                <label for="streetAddress2" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.street_address_2"|trans }}</label>
                                <input type="text" class="form-control form-control-sm sc-form-input" id="streetAddress2"
                                       name="streetAddress2" placeholder="Apt 4B"/>
                            </div>
                        </div>

                        <div class="row sc-form-row">
                            <div class="col-md-6 mb-2 sc-form-col">
                                <label for="city" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.city"|trans }}</label>
                                <input type="text" class="form-control form-control-sm sc-form-input" id="city" name="city"
                                       placeholder="New York" required/>
                            </div>

                            <div class="col-md-6 mb-2 sc-form-col">
                                <label for="state" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.state"|trans }}</label>
                                <select id="state" name="state" class="form-select form-select-sm sc-form-select" required>
                                    <option value="">{{ "paytrace_shopware6.savedCards.select_state"|trans }}</option>
                                    <option value="AL">{{ "paytrace_shopware6.savedCards.states.AL"|trans }}</option>
                                    <option value="AK">{{ "paytrace_shopware6.savedCards.states.AK"|trans }}</option>
                                    <option value="AZ">{{ "paytrace_shopware6.savedCards.states.AZ"|trans }}</option>
                                    <option value="AR">{{ "paytrace_shopware6.savedCards.states.AR"|trans }}</option>
                                    <option value="CA">{{ "paytrace_shopware6.savedCards.states.CA"|trans }}</option>
                                    <option value="CO">{{ "paytrace_shopware6.savedCards.states.CO"|trans }}</option>
                                    <option value="CT">{{ "paytrace_shopware6.savedCards.states.CT"|trans }}</option>
                                    <option value="DE">{{ "paytrace_shopware6.savedCards.states.DE"|trans }}</option>
                                    <option value="DC">{{ "paytrace_shopware6.savedCards.states.DC"|trans }}</option>
                                    <option value="FL">{{ "paytrace_shopware6.savedCards.states.FL"|trans }}</option>
                                    <option value="GA">{{ "paytrace_shopware6.savedCards.states.GA"|trans }}</option>
                                    <option value="HI">{{ "paytrace_shopware6.savedCards.states.HI"|trans }}</option>
                                    <option value="ID">{{ "paytrace_shopware6.savedCards.states.ID"|trans }}</option>
                                    <option value="IL">{{ "paytrace_shopware6.savedCards.states.IL"|trans }}</option>
                                    <option value="IN">{{ "paytrace_shopware6.savedCards.states.IN"|trans }}</option>
                                    <option value="IA">{{ "paytrace_shopware6.savedCards.states.IA"|trans }}</option>
                                    <option value="KS">{{ "paytrace_shopware6.savedCards.states.KS"|trans }}</option>
                                    <option value="KY">{{ "paytrace_shopware6.savedCards.states.KY"|trans }}</option>
                                    <option value="LA">{{ "paytrace_shopware6.savedCards.states.LA"|trans }}</option>
                                    <option value="ME">{{ "paytrace_shopware6.savedCards.states.ME"|trans }}</option>
                                    <option value="MD">{{ "paytrace_shopware6.savedCards.states.MD"|trans }}</option>
                                    <option value="MA">{{ "paytrace_shopware6.savedCards.states.MA"|trans }}</option>
                                    <option value="MI">{{ "paytrace_shopware6.savedCards.states.MI"|trans }}</option>
                                    <option value="MN">{{ "paytrace_shopware6.savedCards.states.MN"|trans }}</option>
                                    <option value="MS">{{ "paytrace_shopware6.savedCards.states.MS"|trans }}</option>
                                    <option value="MO">{{ "paytrace_shopware6.savedCards.states.MO"|trans }}</option>
                                    <option value="MT">{{ "paytrace_shopware6.savedCards.states.MT"|trans }}</option>
                                    <option value="NE">{{ "paytrace_shopware6.savedCards.states.NE"|trans }}</option>
                                    <option value="NV">{{ "paytrace_shopware6.savedCards.states.NV"|trans }}</option>
                                    <option value="NH">{{ "paytrace_shopware6.savedCards.states.NH"|trans }}</option>
                                    <option value="NJ">{{ "paytrace_shopware6.savedCards.states.NJ"|trans }}</option>
                                    <option value="NM">{{ "paytrace_shopware6.savedCards.states.NM"|trans }}</option>
                                    <option value="NY">{{ "paytrace_shopware6.savedCards.states.NY"|trans }}</option>
                                    <option value="NC">{{ "paytrace_shopware6.savedCards.states.NC"|trans }}</option>
                                    <option value="ND">{{ "paytrace_shopware6.savedCards.states.ND"|trans }}</option>
                                    <option value="OH">{{ "paytrace_shopware6.savedCards.states.OH"|trans }}</option>
                                    <option value="OK">{{ "paytrace_shopware6.savedCards.states.OK"|trans }}</option>
                                    <option value="OR">{{ "paytrace_shopware6.savedCards.states.OR"|trans }}</option>
                                    <option value="PA">{{ "paytrace_shopware6.savedCards.states.PA"|trans }}</option>
                                    <option value="RI">{{ "paytrace_shopware6.savedCards.states.RI"|trans }}</option>
                                    <option value="SC">{{ "paytrace_shopware6.savedCards.states.SC"|trans }}</option>
                                    <option value="SD">{{ "paytrace_shopware6.savedCards.states.SD"|trans }}</option>
                                    <option value="TN">{{ "paytrace_shopware6.savedCards.states.TN"|trans }}</option>
                                    <option value="TX">{{ "paytrace_shopware6.savedCards.states.TX"|trans }}</option>
                                    <option value="UT">{{ "paytrace_shopware6.savedCards.states.UT"|trans }}</option>
                                    <option value="VT">{{ "paytrace_shopware6.savedCards.states.VT"|trans }}</option>
                                    <option value="VA">{{ "paytrace_shopware6.savedCards.states.VA"|trans }}</option>
                                    <option value="WA">{{ "paytrace_shopware6.savedCards.states.WA"|trans }}</option>
                                    <option value="WV">{{ "paytrace_shopware6.savedCards.states.WV"|trans }}</option>
                                    <option value="WI">{{ "paytrace_shopware6.savedCards.states.WI"|trans }}</option>
                                    <option value="WY">{{ "paytrace_shopware6.savedCards.states.WY"|trans }}</option>
                                    <option value="AS">{{ "paytrace_shopware6.savedCards.states.AS"|trans }}</option>
                                    <option value="GU">{{ "paytrace_shopware6.savedCards.states.GU"|trans }}</option>
                                    <option value="MP">{{ "paytrace_shopware6.savedCards.states.MP"|trans }}</option>
                                    <option value="PR">{{ "paytrace_shopware6.savedCards.states.PR"|trans }}</option>
                                    <option value="VI">{{ "paytrace_shopware6.savedCards.states.VI"|trans }}</option>
                                    <option value="AA">{{ "paytrace_shopware6.savedCards.states.AA"|trans }}</option>
                                    <option value="AE">{{ "paytrace_shopware6.savedCards.states.AE"|trans }}</option>
                                    <option value="AP">{{ "paytrace_shopware6.savedCards.states.AP"|trans }}</option>
                                </select>
                            </div>
                        </div>

                        <div class="row sc-form-row">
                            <div class="col-md-6 mb-2 sc-form-col">
                                <label for="postalCode" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.postal_code"|trans }}</label>
                                <input type="text" class="form-control form-control-sm sc-form-input" id="postalCode"
                                       name="postalCode" placeholder="10001" required/>
                            </div>

                            <div class="col-md-6 mb-2 sc-form-col">
                                <label for="country" class="form-label sc-form-label">{{ "paytrace_shopware6.savedCards.country"|trans }}</label>
                                <select id="country" name="country" class="form-select form-select-sm sc-form-select"
                                        required>
                                    <option value="">{{ "paytrace_shopware6.savedCards.select_country"|trans }}</option>
                                    <option value="US" selected>United States</option>
                                </select>
                            </div>
                        </div>

                        <div id="pt_hpf_form" class="my-3 sc-form-payment-fields"></div>
                        <div id="paytrace-loading-indicator" class="d-none" style="text-align:center; margin: 15px 0;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div id="errorContainer" class="error-container sc-form-error" style="display: none;"></div>

                        <button type="button" id="ProtectForm" class="btn btn-primary w-100 mt-3 sc-form-submit">
                            <i class="fas fa-credit-card sc-form-submit-icon"></i> {{ "paytrace_shopware6.savedCards.add_card_button"|trans }}
                        </button>
                    </form>
                </div>
            </div>
        </div>

        {% if savedCards is not empty %}
            <div class="container mt-4">
                <div class="row">
                    {% for card in savedCards %}
                        <div class="col-12 col-sm-6 col-md-6 col-lg-6 mb-3">
                            <div class="saved-card p-3 border rounded-3 shadow-sm hover-card">
                                <div class="card-info">
                                    <div class="card-logo mb-2">
                                        {% set cardType = card.cardType|lower %}
                                        {% set logoMap = {
                                            'visa': 'https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png',
                                            'mastercard': 'https://upload.wikimedia.org/wikipedia/commons/e/e1/Mastercard.jpg',
                                            'discover': 'https://upload.wikimedia.org/wikipedia/commons/1/1a/Discover.png',
                                            'american express': 'https://upload.wikimedia.org/wikipedia/commons/3/38/American_Express.png'
                                        } %}
                                        {% set logoPath = logoMap[cardType] ?? 'https://via.placeholder.com/80x50?text=Card' %}
                                        <img src="{{ logoPath }}" alt="{{ card.cardType }}" class="card-logo-img">
                                    </div>
                                    <p class="card-holder-name mb-1"><strong>{{ card.cardHolderName }}</strong></p>
                                    <p class="card-type mb-1">{{ card.cardType }}</p>
                                    <div class="paytrace-card-number mb-2">
                                        <span>**** **** **** {{ card.lastDigits }}</span>
                                    </div>
                                    <button class="btn btn-danger delete-card-btn mt-2"
                                            data-card-id="{{ card.vaultedCustomerId }}">{{ 'paytrace_shopware6.savedCards.delete_button' | trans }}
                                    </button>

                                    <div class="delete-loading-indicator d-none text-center my-2">
                                        <div class="spinner-border text-danger" role="status" style="width: 1.5rem; height: 1.5rem;">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

        {% else %}
            <p class="text-center mt-4">{{ "paytrace_shopware6.savedCards.no_cards"| trans }}</p>
        {% endif %}
        {% if mode == 'sandbox' %}
            <script src='https://protect.sandbox.paytrace.com/js/protect.min.js'></script>
        {% else %}
            <script src='https://protect.paytrace.com/js/protect.min.js'></script>
          <script>
          </script>
        {% endif %}

    </div>


    <div id="paytrace-saved-cards-jsData"
         data-jsData="{{ {
             'translations': {
                 'paytrace_shopware6.savedCards.js.toggle_show_form': 'paytrace_shopware6.savedCards.js.toggle_show_form'|trans,
                 'paytrace_shopware6.savedCards.js.toggle_hide_form': 'paytrace_shopware6.savedCards.js.toggle_hide_form'|trans,
                 'paytrace_shopware6.savedCards.js.error_delete_failed': 'paytrace_shopware6.savedCards.js.error_delete_failed'|trans,
                 'paytrace_shopware6.savedCards.js.error_confirm_delete': 'paytrace_shopware6.savedCards.js.error_confirm_delete'|trans,
                 'paytrace_shopware6.savedCards.js.error_required_field': 'paytrace_shopware6.savedCards.js.error_required_field'|trans
             }
         } | json_encode | escape('html_attr') }}">
    </div>


{% endblock %}
