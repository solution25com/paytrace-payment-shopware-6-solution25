{% if page.extensions.payTrace_payment.clientKey %}
<template payTrace-payment-credit-card-plugin></template>
<div id="payTrace_payment" data-payTrace-credit-card="true"
     data-client-key="{{ page.extensions.payTrace_payment.clientKey }}"
     data-amount="{{ page.extensions.payTrace_payment.amount }}"
     data-is-guest="{{ page.extensions.payTrace_payment.isGuest }}"
     data-cardsDropdown="{{ page.extensions.payTrace_payment.cardsDropdown }}">


  <form class="mt-3" id="saved-card-form">

    {% if not page.extensions.payTrace_payment.isGuest %}
      <div id="saved-cards-wrapper" class="mb-2">
        <label for="saved-cards" class="form-label">Choose a saved card:</label>
        <select id="saved-cards" name="saved-cards" class="form-select form-select-sm">
          <option value="">-- Select a saved card --</option>
        </select>
      </div>
    {% endif %}

    <input type="button" id="SelectCardButton" value="Pay with Saved Card"
           class="btn btn-secondary w-100 btn-sm" style="display:none;">
  </form>
  <div class="card" style="max-width: 500px; margin: 0 auto;">
    <div class="card-body">
        <div class="" id='pt_hpf_form'></div>
      <div>
        <span class="error-message alert-danger d-none" id="error-message" role="alert"></span>
      </div>
    </div>
  </div>

  <script src='https://protect.sandbox.paytrace.com/js/protect.min.js'></script>
</div>
{% else %}
  <div id="error-message">
    <div class="error-alert">
      <strong>PayTrace Configuration Missing or Incorrect:</strong>
      <p>Required API credentials are missing. Please check your plugin settings for <code>Sandbox</code> or <code>Production</code>.</p>
    </div>
  </div>
{% endif %}


<style>
    #payTrace_payment .error-message {
        margin-bottom: 10px;
        border-radius: 4px;
        font-size: 13px;
    }

    #pt_hpf_form iframe {
        /*width: 90% !important;*/
        height: 300px !important;
        margin-top:25px;
        border: none;
        overflow: hidden;
    }

    #payTrace_payment .alert-danger {
        background-color: #f8d7da;
        color: #842029;
        border: 1px solid #f5c2c7;
    }

    #payTrace_payment .form-control-sm,
    #payTrace_payment .form-select-sm {
        font-size: 0.875rem;
        padding: 0.45rem 0.75rem;
        height: auto;
        border: 1px solid #ced4da;
        border-radius: 6px;
        background-color: #fff;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    #payTrace_payment .form-control-sm:focus,
    #payTrace_payment .form-select-sm:focus {
        border-color: #66afe9;
        box-shadow: 0 0 0 0.15rem rgba(102, 175, 233, 0.25);
        outline: none;
    }

    #payTrace_payment label.form-label {
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
        font-weight: 500;
    }

    #payTrace_payment .card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #333;
    }

    #payTrace_payment .btn-sm {
        font-size: 0.9rem;
        padding: 0.5rem;
        border-radius: 5px;
    }

    #payTrace_payment .card {
        border: 1px solid #e3e6f0;
        border-radius: 8px;
        padding: 15px;
    }

    #payTrace_payment .btn-primary {
        background-color: #0069d9;
        border-color: #0062cc;
    }

    #payTrace_payment .btn-primary:hover {
        background-color: #0056b3;
        border-color: #004a99;
    }

    #payTrace_payment .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    #payTrace_payment .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
    }
    #error-message {
        margin: 10px 0;
        background-color: transparent;
    }

    #error-message .error-alert {
        padding: 6px 12px;
        align-items: flex-start;
        border-radius: 4px;
        background: #F9DDDD;
        color: #D72828;
        font-size: 14px;
        font-style: normal;
        font-weight: 400;
        line-height: 20px;
    }


</style>

